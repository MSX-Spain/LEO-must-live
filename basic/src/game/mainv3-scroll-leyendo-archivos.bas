1 '' ******************************
1 '' Program:  SAM must live
1 '' autor:    MSX spain
1 '' ******************************
1 '***************
1 '****Variables**
1 '***************
1 'f=fase'
1 'me$=mensaje'
1 'mc=counter map, para ir pintando el mapa con los tiles'
1 'ml=limit map, el ancho del mapa'
1 'ig=in game, nos permite saber si el juego está corriendo'

1 'ts=solid tile, tile a partir que está el suelo'
1 'td=dead tile, tile que te matan'
1 't3,t5,t7=tile derecha, tile abajo y tile izquierda'

1 'x, y=player coordinates
1 'v=velocidad horizontal'
1 'o=old y position'
1 'a=player está saltando'
1 'p,p0,p1,p2,p3=sprite asignado que irá cambiando con los valores de p0 a p3'

1 'mp=mapa direction'
1 'dat=datos, usada para el restore de los datas'
1 'r, c=row and column for bucle'

1 '****************
1 '***Subrrutinas**
1 '****************
1 ' 9000 Rutina cargar sprites en VRAM con datas basic''


1 'El interval on es para mostrar el tiempo'
110 me$="":ON INTERVAL=50 GOSUB 2100
120 f=1:ts=37:td=30:mc=0:ml=100:dim m(32,16)
130 gosub 1800
140 x=0:y=9*8:v=4:P=0:P0=0:P1=1:P2=2:P3=3:PUTSPRITE0,(x,y),4,p
150 goto 500

1 'Main-loop'
    200 s=STICK(0)ORSTICK(1)
    1 ' on variable goto numero_linea1, numero_linea2,etc salta a la linea 1,2,etc o si es cero continua la ejecución '
    210 ON s GOTO 230,250,270,290,310,330,350,370
    220 goto 400

    1 'movimiento hacia arriba o salto
    230 Y=Y-4
    1 '1 Pulsado la tecla 1 Saltamos y reproducimos un sonido'
    1 '230 if a=0 and t5>=ts then o=y:a=1:GOTO 210
    240 GOTO 400
    1 '2 Pulsado 2 movimiento hacia arriba derecha o salto hacia arriba'
    250 X=X+4:if a=0 and t5>=ts then o=y:a=1
    1 ' ponemos el sprite 0 o 1 que corresponde a los de la derecha'
    260 P=P0:SWAPP0,P1:GOTO 400
    1 '3 pulsado Movimiento hacia la derecha '
    270 X=X+v
    280 P=P0:SWAPP0,P1:GOTO 400
    1 '4 Movimiento abajo derecha'
    290 X=X+v
    300 P=P0:SWAPP0,P1:GOTO 400
    1 '5 Movimiento  abajo'
    310 Y=Y+4
    320 P=P0:SWAPP0,P1:GOTO 400
    1 '6 Moviemiento abajo izquierda'
    330 'Y=Y+4:X=X-4
    340 P=P2:SWAPP2,P3:GOTO 400
    1 '7 Movimiento izquierd'
    350 X=X-v
    360 P=P2:SWAPP2,P3:GOTO 400
    1 '8 movimiento arriba izquierda'
    370 X=X-v:if a=0 and t5>=ts then o=y:a=1
    380 P=P2:SWAPP2,P3


    1 'Chequeo colisiones pantalla'
    400 IF Y<56 THEN Y=56 else if y>120 then y=120
    410 if x<0 then x=0 else if x>240 then x=240
    1 'Si el player está saltando, irá hacia arrina hasta -16'
    1 ' 420 if a=1 then y=y-8:if y<o-16 then a=0
    1 'Si el player está cayendo
    1 '430 if a=0 and t5<ts or t5=255 then y=y+8 
    1 'Actualizamos las variables con los tiles t1,t3,t5,t7'
    1 '     ^ t1  '
    1 '     |     '
    1 't7 <- -> t3'
    1 '     |     '
    1 '     v t5  '
    1 '440 hl=base(10)+(((y/8)+1)*32)+((x/8)+1):t3=vpeek(hl)
    450 hl=base(10)+(((y/8)+2)*32)+((x/8)+1):t5=vpeek(hl)
    1 '460 hl=base(10)+(((y/8)+1)*32)+((x/8)):t7=vpeek(hl)
    1 'Si t5 es el tile de la muerte td=dead tile, matamos al player
    470 if t5=td or t3=td or t7=td then gosub 4000
    1 '475 if t3>=ts then x=x-v else if t7>=ts then x=x+v
    480 PUTSPRITE0,(X,Y),4,P
    1'482 t1=time/50:if t1<>t2 then:gosub 2100:t2=t1
    482 mc=time/50
    483 if mc mod 2=0 and mc<ml then restore 22000:gosub 21000
    

    1 '484 if m2<>mc then restore 22000:gosub 21000:m2=mc
    1 '3000= debug'
    485 'gosub 3000
    490 ON f GOSUB 530,630,730,930,1130,1330,1530
495 goto 200




1 'Fase 1'
1'--------
1 'se pinta el mapa de tiles y se inicializa'
500 'restore 22000
501 gosub 21000
1 'Activamos las interrupciones de intervalo para mostrar el tiempo'
503 time=0:interval on
510 'se inicializan os enemigos, se pintan los objetos y el marcador
520 goto 200
530 if mc=ml then print #1, "fase completada": goto 600
540 'pintamos los enemigos
550 'Actualizamos los enemigos
590 return 200

1 'Fase 2'
1'--------
600 f=2:x=0:y=9*8:gosub 21000
610 goto 200
630 if x>232 then goto 700
640 'lo mismo que en la fase 1
690 return 200

1 'Fase 3'
1'--------
700 f=3:x=0:y=9*8:gosub 21000
710 goto 200
730 if x>232 then goto 1700
740 'lo mismo que en la fase 1
790 return 200

1 'Fase 4'
1'--------
900 f=4:x=0:y=9*8:gosub 21000
910 goto 200
930 if x>240 then goto 1100 
940 'lo mismo que en la fase 1
990 return 200

1 'Fase 5'
1'--------
1100 f=5:x=0:y=9*8:gosub 21000
1110 goto 200
1130 if x>240 then goto 1300
1140 'lo mismo que en la fase 1
1190 return 200

1 'Fase 6'
1'--------
1300 f=6:x=0:y=9*8:gosub 21000
1310 goto 200
1330 if x>240 then goto 1500 
1340 'lo mismo que en la fase 1
1390 return 200

1 'Fase 7'
1'--------
1500 f=7:x=0:y=9*8:gosub 21000
1510 goto 200
1530 if x>240 then goto 1700
1590 return 200


1' Pantalla ganadora
    1700 me$="^Tu ganas":gosub 2000
    1710 ON STRIG GOSUB 1790:STRIG(0)ON
    1720 GOTO 1720
1790 STRIG(0)OFF:RETURN 110

1 ' menu principal'
    1800 me$="^menu pricipal, pulse una tecla":gosub 2000
    1810 ON STRIG gosub 1890:STRIG(0)ON
    1820 GOTO 1820
1890 STRIG(0)OFF:RETURN 140

1 'HUD'
    2000 line(0,140)-(255,150),1,bf
    2010 preset (0,140):print #1,me$
2020 return

1 'print time'
    2100 line(200,160)-(220,170),1,bf
    2110 preset (200,160):print #1,mc
2190 return
1 'debug'
    3000 line(0,160)-(200,180),1,bf
    3010 preset (0,160):print #1,t3
    1 '3010 preset (0,160):print #1,"t0: "t0", t3:"t3", t5:"t5
    1 '3020 preset (0,170):print #1," x: "x" ,y: "y
    1 '3010 preset (0,160):print #1,"a: "a" ,o: "o" y: "y", -: "o-16
3090 return

1 'Player muere'
4000 x=0:y=9*8
4090 return


1 'Vamos a crear nuestro mapa con una pantalla de 20 tiles de alto x 32 de ancho dehjando los 4 de abajo para el marcador'
1 'Render map, pintar mapa
    1 'Lectora de mapa con un dígito'
    1 '11020 for f=0 to 19
    1 '    11030 READ D$
    1 '    11040 for c=0 to 31
    1 '        11050 tn$=mid$(D$,c+1,1)
    1 '        11060 tn=val(tn$)
    1 '        11070 VPOKE md+c,tn
    1 '    11160 next c
    1 '    11170 md=md+32
    1 '11180 next f
    1 'Lectura de mapa con 2 dígitos'

    1 'El mapa se encuentra en la dirección 6144 / &h1800 - 6912 /1b00'
    21000 _TURBO ON (mc)
    21002 md=6144
    21003 restore 22000
    21050 for r=0 to 15
        21060 READ mp$
        1 ' ahora leemos las columnas c, 63 son 32 tiles
        21070 for c=mc to 63+mc step 2
            21080 tn$=mid$(mp$,c+1,2)
            21090 tn=val("&h"+tn$)
            21095 tn=tn-1
            21100 if tn<>0 and tn<>-1 then VPOKE md,tn
            21110 md=md+1
        21160 next c
    21180 next r
    21190 _TURBO OFF


    1 '1 'Compresión RLE-16'
    1 '21050 for r=0 to 15
    1 '    21060 READ mp$
    1 '    21070 for c=0 to 63 step 4
    1 '        1 'El 1 valor indica la cantidad de repeticiones, el 2 el valor en si'
    1 '        21080 r$=mid$(mp$,c+1,2)
    1 '        21090 tn$=mid$(mp$,c+3,2)
    1 '        21100 tn=val("&h"+tn$):tn=tn-1
    1 '        21110 re=val("&h"+r$)
    1 '        21120 for i=0 to re
    1 '            21130 if tn<>0 and tn<>-1 then VPOKE md,tn
    1 '            21140 md=md+1
    1 '        21150 next i
    1 '    21160 next c
    1 '21180 next r

        


    22000 data 23232323232323232323232323232323232323232323232323232323252523232325232323232323232525232323232323232323232323232323232323232323232525232525252525252523232323232323232323232323232325232525232325252525
    22010 data 23232323232323232323232323232323232323252523232323232323252523232525232323232323232525232323232525232525232323232323232323232323232525252525252525252523232523232323232323252523232525232525232325252525
    22020 data 23252523232323232323232323232525232323252523232323232525252523232525232323232325252525232323232525232525232325232323252523232325252525252525252525252523232525232323252523252523232525232525232325252525
    22030 data 23252523232525232323232323232525232525252523232323232525252523232525232323232325252525232525232525232525232325232323252523232325252525252525252525252523232525232323252523252523232525232525232325252525
    22040 data 23252523232525232323232323232525232525252523232325252525252523232525232525232325252525232525232525232525232325232323252523232325252525252525252525252523232525232323252523252523232525232525232525252525
    22050 data 23252523232525252323232325252525232525252523232325252525252523232525232525232325252525232525232525232525252525232323252523232325252525252525252525252523232525232323252523252523232525232525232525252525
    22060 data 25252525252525252525252525252525252525252525252525252525252525252525252525252525252525252525252525252525252525252525252525252525252525252525252525252525252525252525252525252525252525252525252525252525
    22070 data 21212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121
    22080 data 21212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121
    22090 data 21212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121
    22100 data 21212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121
    22110 data 21212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121
    22120 data 21212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121
    22130 data 21212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121
    22140 data 21212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121
    22150 data 21212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121

    23180 me$=str$(f):gosub 2000
23190 return 
1 '--------------------------------------------------------------------------------------'
1 '-------------------------------------Level 1------------------------------------------'
1 '--------------------------------------------------------------------------------------'

1 'Compresión RLE16'



1 '22000 data 2323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323
1 '22010 data 2323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323
1 '22020 data 2323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323252325252523232323232323232323232323232323232323232323232323232323232323232323232525252323232323232323232323232323232323232323232323232323232323232323232323232323232323
1 '22030 data 2323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323252525232323232323232323232323232323232323232323232525232323232323232323232323232323232525252325252523232323232525232323232523232323232323232323232323232323232323232323232525252325232323232323232323232323232323232323232323232323232323232323232323232323232323
1 '22040 data 2323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323252525252525232323232323232323232323232323232323232523232525252523232323232323232323232525232525252325252523232323232525232525252523232523232323232323232323232323232323232325252525252325252523232323232323232323232323232323232323232325252323232323232323232323252525
1 '22050 data 2323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323252525252525252323232323232323232323232323232323252523232525252523232323232323232323252525232525252325252523252525232525232525252523232525232323232323232323232323232323232325252525252325252525232323232323232323232323232323232525232325252323232525232323232323252525
1 '22060 data 2323232323232323232323232323232323232323232323232323232325252323232523232323232323252523232323232323232323232323232323232323232323252523252525252525252323232323232323232323232323232523252523232525252523232323232323232323252525232525252325252523252525232525232525252523232525232523232323232323232323232323252325252525252325252525232323232323232323232323232323232525232325252323232525252323252323252525
1 '22070 data 2323232323232323232323232323232323232325252323232323232325252323252523232323232323252523232323252523252523232323232323232323232323252525252525252525252323252323232323232325252323252523252523232525252523232523232323232323252525232525252325252523252525232525232525252523232525232525232323232323232323232525252325252525252325252525232325232323232323232323252523232525232325252323232525252323252323252525
1 '22080 data 2325252323232323232323232323252523232325252323232323252525252323252523232323232525252523232323252523252523232523232325252323232525252525252525252525252323252523232325252325252323252523252523232525252523232525232323252523252525232525252325252523252525232525232525252523232525232525232323232323232323232525252325252525252325252525232325252323232323232525252523232525232325252323232525252323252323252525
1 '22090 data 2325252323252523232323232323252523252525252323232323252525252323252523232323232525252523252523252523252523232523232325252323232525252525252525252525252323252523232325252325252323252523252523232525252523232525232525252523252525232525252325252523252525232525232525252523232525232525232323232323252523252525252325252525252325252525232325252323252523232525252523232525232325252323232525252323252323252525
1 '22100 data 2325252323252523232323232323252523252525252323232525252525252323252523252523232525252523252523252523252523232523232325252323232525252525252525252525252323252523232325252325252323252523252523252525252523232525232525252523252525232525252325252523252525232525232525252523232525232525232325232323252523252525252325252525252325252525232325252323252523232525252523232525232325252323232525252323252323252525
1 '22110 data 2325252323252525232323232525252523252525252323232525252525252323252523252523232525252523252523252523252525252523232325252323232525252525252525252525252323252523232325252325252323252523252523252525252523232525232525252523252525232525252325252523252525232525232525252523232525232525232325252523252523252525252325252525252325252525232325252323252523232525252523232525232325252323232525252323252323252525
1 '22120 data 2525252525252525252525252525252525252525252525252525252525252525252525252525252525252525252525252525252525252525252525252525252525252525252525252525252525252525252525252525252525252525252525252525252525252525252525252525252525252525252525252525252525252525252525252525252525252525252525252525252525252525252525252525252525252525252525252525252525252525252525252525252525252525252525252525252525252525
1 '22130 data 2121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121
1 '22140 data 2121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121
1 '22150 data 2121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121

